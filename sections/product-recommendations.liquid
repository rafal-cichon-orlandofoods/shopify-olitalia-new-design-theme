<product-recommendations
  class="product-recommendations"
  data-url="{{ routes.product_recommendations_url }}?section_id={{ section.id }}&product_id={{ product.id }}&limit=4&intent=related"
>
  {%- if recommendations.performed and recommendations.products_count > 0 -%}
    <div class="container--large container--vertical-space{% if section.settings.gutter_decrease %}-small{% endif %} {% if section.settings.section_background_color != "rgba(0,0,0,0)" or section.settings.section_background_gradient != blank %} container--has-background {% endif %} {% if section.settings.remove_bottom_margin %} container--negative-margin {% endif %} remove-empty-space">
      {%- render 'section-heading',
        heading: section.settings.heading,
        subheading: section.settings.subheading,
        heading_size: section.settings.section_heading_size,
        section_layout: section.settings.section_heading_layout,
        seo_h_tag: 'span'
      -%}

      {%- liquid
        if section.settings.layout_desktop == 'five-columns'
          assign grid_class_desktop = 'grid-5 grid-laptop-4 grid-portable-3 grid-lap-2'
        elsif section.settings.layout_desktop == 'four-columns'
          assign grid_class_desktop = 'grid-4 grid-laptop-3 grid-lap-2'
        else
          assign grid_class_desktop = 'grid-3 grid-portable-2'
        endif
      -%}

      {%- if section.settings.style == 'slider' -%}
        <css-slider
          data-options='
            {
              "selector": ".product-item",
              "groupCells": true,
              "navigationDOM": "<span class=\"css-slider-button css-slider-prev\" style=\"display:none\"><svg fill=\"none\" height=\"11\" viewBox=\"0 0 6 11\" width=\"6\" xmlns=\"http://www.w3.org/2000/svg\"><path clip-rule=\"evenodd\" d=\"m4.32845 10.0708-4.18198-4.18194c-.195261-.19526-.195261-.51185 0-.70711l4.18198-4.181979c.19527-.195262.51185-.195262.70711 0 .19526.195259.19526.511849 0 .707109l-3.32843 3.32842s-.70713.4647-.00002 1l3.32845 3.32843c.19526.19526.19526.51185 0 .70707-.19526.1953-.51185.1953-.70711 0z\" fill=\"#000\" fill-rule=\"evenodd\"/></svg></span><span class=\"css-slider-button css-slider-next\" style=\"display:none\"><svg fill=\"none\" height=\"11\" viewBox=\"0 0 6 11\" width=\"6\" xmlns=\"http://www.w3.org/2000/svg\"><path clip-rule=\"evenodd\" d=\"m.853555.999962 4.181985 4.181978c.19526.19526.19526.51185 0 .70711l-4.181983 4.18195c-.195263.1953-.511845.1953-.707108 0-.1952631-.19523-.1952632-.51181 0-.70708l3.328431-3.32842s.70713-.4647.00002-1l-3.328453-3.32843c-.1952626-.19526-.1952627-.51185 0-.707108.195263-.195262.511845-.195262.707108 0z\" fill=\"#000\" fill-rule=\"evenodd\"/></svg></span>",
              "thumbnailsDOM": "<div class=\"css-slider-dot-navigation\" style=\"display:none;--size:{{ section.blocks.size }}\"></div>"
            }
          '
          class="css-slider css-slider--bottom-navigation"
          id="css-slider-{{ section.id }}"
        >
      {%- endif -%}

      <div class="grid {% if section.settings.style == 'slider' %} grid--slider {% else %} grid--layout {% endif %} {{ grid_class_desktop }} {{ section.settings.layout_mobile }} {% if section.settings.layout_mobile_less_items %} reduce-recommendations-on-mobile {% endif %}">
        {%- liquid
          for recommendation in recommendations.products
            render 'product-item', product: recommendation, section_blocks: section.blocks, index: forloop.index, layout: grid_class_desktop, mobile_layout: section.settings.layout_mobile
          endfor
        -%}
      </div>

      {%- if section.settings.style == 'slider' -%}</css-slider>{%- endif -%}
    </div>
  {%- endif -%}
</product-recommendations>

<style>
  {%- if section.settings.section_background_color != "rgba(0,0,0,0)" -%}
    #shopify-section-{{ section.id }} {
      background-color: {{ section.settings.section_background_color }};
    }
  {%- endif -%}
  {%- if section.settings.section_background_gradient != blank -%}
    #shopify-section-{{ section.id }} {
      background-image: {{ section.settings.section_background_gradient }};
    }
  {%- endif -%}
  {%- if section.settings.section_heading_color != "rgba(0,0,0,0)" -%}
    #shopify-section-{{ section.id }} .section-heading,
    #shopify-section-{{ section.id }} .section-footer {
      --color-text-main: {{ section.settings.section_heading_color }};
      --color-borders-forms-primary: {{ section.settings.section_heading_color | color_modify: 'alpha', 0.3 }};
    }
  {%- endif -%}
</style>

<div style="display:none" data-js-product-item-skeleton>
  {%- render 'product-item-skeleton',
    section_blocks: section.blocks,
    layout: grid_class_desktop,
    mobile_layout: section.settings.layout_mobile
  -%}
</div>

{% schema %}
{
  "name": "t:sections.product-recommendations.name",
  "class": "has-skeleton",
  "blocks": [
    {
      "type": "price",
      "name": "t:sections.local-extra-words.sections.product-card.blocks.price",
      "limit": 1
    },
    {
      "type": "title",
      "name": "t:sections.local-extra-words.sections.product-card.blocks.title",
      "limit": 1
    },
    {
      "type": "description",
      "name": "t:sections.main-product.blocks.description.name",
      "limit": 1,
      "settings": [
        {
          "type": "range",
          "id": "excerpt_limit",
          "label": "t:sections.local-extra-words.sections.blog-posts.blocks.summary.settings.excerpt_limit",
          "info": "t:sections.bundle-extra-words.sections.products_set.blocks.description.info",
          "default": 15,
          "step": 1,
          "min": 5,
          "max": 40
        },
        {
          "type": "checkbox",
          "id": "show_link",
          "label": "t:sections.bundle-extra-words.sections.products_set.blocks.description.link",
          "default": true
        }
      ]
    },
    {
      "type": "vendor",
      "name": "t:sections.local-extra-words.sections.product-card.blocks.vendor",
      "limit": 1
    },
    {
      "type": "rating",
      "name": "t:sections.local-extra-words.sections.product-card.blocks.rating",
      "limit": 1
    },
    {
      "type": "icons",
      "name": "t:sections.local-extra-words.sections.main-product.blocks.icons.name",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "t:sections.local-extra-words.sections.main-product.blocks.icons.help"
        }
      ]
    },
    {
      "type": "text",
      "name": "t:sections.local-extra-words.sections.product-card.blocks.text.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "metafield",
          "label": "t:sections.local-extra-words.sections.product-card.blocks.text.settings.text.label",
          "info": "t:sections.local-extra-words.sections.product-card.blocks.text.info",
          "default": "custom.product_text"
        },
        {
          "type": "select",
          "id": "text_color",
          "label": "t:sections.local-extra-words.sections.product-card.blocks.text.settings.color.label",
          "options": [
            {
              "value": "",
              "label": "t:sections.bundle-extra-words.sections.product_grid.blocks.text.settings.text_color.option__1"
            },
            {
              "value": "text-color--opacity",
              "label": "t:sections.bundle-extra-words.sections.product_grid.blocks.text.settings.text_color.option__2"
            }
          ],
          "default": "text-color--opacity"
        },
        {
          "type": "checkbox",
          "id": "text_transform",
          "label": "t:sections.local-extra-words.sections.product-card.blocks.text.settings.transform.label",
          "default": false
        }
      ]
    },
    {
      "type": "quick_buy",
      "name": "t:sections.local-extra-words.sections.product-card.blocks.quick_buy",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "label": "t:bundle-250.modal_quick_buy.label",
          "id": "type",
          "options": [
            {
              "value": "inline",
              "label": "t:bundle-250.modal_quick_buy.options.option_1"
            },
            {
              "value": "modal",
              "label": "t:bundle-250.modal_quick_buy.options.option_2"
            }
          ],
          "default": "inline"
        },
        {
          "type": "checkbox",
          "id": "show_only_available",
          "label": "t:sections.bundle-extra-words.sections.product_grid.blocks.quick_buy.settings.show_only_available.label",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "show_price",
          "label": "t:sections.bundle-extra-words.sections.product_grid.blocks.quick_buy.settings.show_price.label",
          "default": true
        },
        {
          "type": "header",
          "content": "t:bundle-250.modal_quick_buy.settings.inline_label",
          "visible_if": "{{ block.settings.type == 'inline' }}"
        },
        {
          "type": "checkbox",
          "id": "variant_default",
          "visible_if": "{{ block.settings.type == 'inline' }}",
          "label": "t:sections.bundle-extra-words.sections.product_grid.blocks.quick_buy.settings.variant_default.label",
          "info": "t:sections.bundle-extra-words.sections.product_grid.blocks.quick_buy.settings.variant_default.info",
          "default": false
        },
        {
          "type": "select",
          "id": "unavailable_variants",
          "visible_if": "{{ block.settings.type == 'inline' }}",
          "label": "t:sections.bundle-extra-words.sections.product_grid.blocks.quick_buy.settings.unavailable_variants.label",
          "options": [
            {
              "value": "disable",
              "label": "t:sections.bundle-extra-words.sections.product_grid.blocks.quick_buy.settings.unavailable_variants.option_2"
            },
            {
              "value": "hide",
              "label": "t:sections.bundle-extra-words.sections.product_grid.blocks.quick_buy.settings.unavailable_variants.option_1"
            },
            {
              "value": "show",
              "label": "t:sections.bundle-extra-words.sections.product_grid.blocks.quick_buy.settings.unavailable_variants.option_3"
            }
          ],
          "default": "hide"
        },
        {
          "type": "header",
          "content": "t:bundle-250.modal_quick_buy.settings.modal_label",
          "visible_if": "{{ block.settings.type == 'modal' }}",
          "info": "t:bundle-250.modal_quick_buy.settings.modal_info"
        }
      ]
    },
    {
      "type": "product_link",
      "name": "t:sections.bundle-extra-words.sections.product_grid.blocks.product_link.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "button_label",
          "label": "t:sections.bundle-extra-words.sections.product_grid.blocks.product_link.settings.button_label.label",
          "default": "View product"
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "header",
      "content": "t:sections.bundle-extra-words.sections.headings.name"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "t:sections.local-extra-words.sections.headings.heading",
      "default": "Recommended"
    },
    {
      "type": "inline_richtext",
      "id": "subheading",
      "label": "t:sections.local-extra-words.sections.headings.subheading",
      "default": "You may also <strong>like</strong> these products"
    },
    {
      "type": "select",
      "id": "section_heading_size",
      "label": "t:sections.bundle-extra-words.sections.headings.size.label",
      "options": [
        {
          "value": "text-size--regular",
          "label": "t:sections.bundle-extra-words.sections.headings.size.option_1"
        },
        {
          "value": "text-size--large",
          "label": "t:sections.bundle-extra-words.sections.headings.size.option_2"
        }
      ],
      "default": "text-size--regular"
    },
    {
      "type": "select",
      "id": "section_heading_layout",
      "label": "t:sections.bundle-extra-words.sections.headings.alignment.label",
      "options": [
        {
          "value": "section-heading--left section-heading--one-row",
          "label": "t:sections.bundle-extra-words.sections.headings.alignment.option_1",
          "group": "t:sections.bundle-extra-words.sections.headings.layout.option_1"
        },
        {
          "value": "section-heading--left section-heading--two-rows",
          "label": "t:sections.bundle-extra-words.sections.headings.alignment.option_1",
          "group": "t:sections.bundle-extra-words.sections.headings.layout.option_2"
        },
        {
          "value": "section-heading--center section-heading--two-rows",
          "label": "t:sections.bundle-extra-words.sections.headings.alignment.option_2",
          "group": "t:sections.bundle-extra-words.sections.headings.layout.option_2"
        }
      ],
      "default": "section-heading--left section-heading--one-row"
    },
    {
      "type": "header",
      "content": "t:sections.bundle-extra-words.sections.headings.layout.label"
    },
    {
      "type": "select",
      "id": "layout_desktop",
      "label": "t:sections.local-extra-words.sections.columns.name",
      "options": [
        {
          "value": "three-columns",
          "label": "t:sections.local-extra-words.sections.columns.option__2"
        },
        {
          "value": "four-columns",
          "label": "t:sections.local-extra-words.sections.columns.option__3"
        },
        {
          "value": "five-columns",
          "label": "t:sections.local-extra-words.sections.columns.option__4"
        }
      ],
      "default": "four-columns"
    },
    {
      "type": "select",
      "id": "layout_mobile",
      "label": "t:sections.local-extra-words.sections.columns.name_mobile",
      "options": [
        {
          "value": "grid-palm-1",
          "label": "t:sections.local-extra-words.sections.columns.option__0"
        },
        {
          "value": "grid-palm-2",
          "label": "t:sections.local-extra-words.sections.columns.option__1"
        }
      ],
      "default": "grid-palm-2"
    },
    {
      "type": "select",
      "id": "style",
      "label": "t:sections.featured-collection.settings.layout.label",
      "info": "t:combine-260.labels.slider_layout_info",
      "options": [
        {
          "label": "t:sections.featured-collection.settings.layout.options__1.label",
          "value": "slider"
        },
        {
          "label": "t:sections.featured-collection.settings.layout.options__2.label",
          "value": "grid"
        }
      ],
      "default": "grid"
    },
    {
      "type": "checkbox",
      "label": "Display less items on mobile",
      "default": true,
      "id": "layout_mobile_less_items"
    },
    {
      "type": "header",
      "content": "t:bundle-240.section_design"
    },
    {
      "type": "color",
      "id": "section_background_color",
      "label": "t:bundle-240.background_color",
      "default": "rgba(0,0,0,0)"
    },
    {
      "type": "color_background",
      "id": "section_background_gradient",
      "label": "t:bundle-240.background_gradient"
    },
    {
      "type": "color",
      "id": "section_heading_color",
      "label": "t:bundle-240.heading_text_color",
      "default": "rgba(0,0,0,0)"
    },
    {
      "type": "header",
      "content": "t:sections.bundle-extra-words.sections.headings.gutter.label"
    },
    {
      "type": "checkbox",
      "id": "gutter_decrease",
      "label": "t:sections.bundle-extra-words.sections.headings.gutter.content",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "remove_bottom_margin",
      "label": "t:sections.local-extra-words.settings_schema.layout.sections.remove_bottom_margin",
      "default": false
    }
  ]
}
{% endschema %}

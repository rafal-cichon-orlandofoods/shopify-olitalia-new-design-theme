{{ 'redesign-header.css' | asset_url | stylesheet_tag }}

<header class="redesign-header">
  <div class="redesign-header__container">
    
    {% comment %} Left Side - Logo (Desktop) / Hamburger Menu (Mobile) {% endcomment %}
    <div class="redesign-header__left">
      <div class="redesign-header__logo">
        <a href="{{ routes.root_url }}">
          {% if section.settings.logo %}
            <img src="{{ section.settings.logo | image_url: width: 200 }}" alt="{{ shop.name }}" width="200" height="80">
          {% else %}
            <img src="/cdn/shop/files/olitalia_logo_black.svg?v=1766151501&width=200" alt="Olitalia" width="200" height="80">
          {% endif %}
        </a>
      </div>
      
      {% comment %} Mobile Menu Icon - Only visible on mobile {% endcomment %}
      <button class="redesign-header__menu-icon" aria-label="Menu" onclick="toggleMenu()">
        <span class="redesign-header__menu-line"></span>
        <span class="redesign-header__menu-line"></span>
        <span class="redesign-header__menu-line"></span>
      </button>
    </div>
    
    {% comment %} Center - Navigation Menu (Desktop) / Logo (Mobile) {% endcomment %}
    <div class="redesign-header__center">
      <nav class="redesign-header__nav">
        <a href="{{ routes.root_url }}" class="redesign-header__nav-link">Home</a>
        <a href="/products/extra-virgin-olive-oil" class="redesign-header__nav-link">Products</a>
        <a href="/pages/recipes" class="redesign-header__nav-link">Recipes</a>
        <a href="/pages/about-us" class="redesign-header__nav-link">About Us</a>
        <a href="/pages/production" class="redesign-header__nav-link">Production</a>
        <a href="/pages/sustainability" class="redesign-header__nav-link">Sustainability</a>
        
        {% comment %} External Links from blocks {% endcomment %}
        {%- for block in section.blocks -%}
          {%- if block.type == 'external-link' -%}
            {%- if block.settings.url != blank and block.settings.label != blank -%}
              <a 
                href="{{ block.settings.url }}" 
                class="redesign-header__nav-link"
                {{ block.shopify_attributes }}
                {% if block.settings.open_in_new_window %}
                  target="_blank" 
                  rel="noopener noreferrer"
                  aria-label="{{ block.settings.label }} (opens in new window)"
                {% endif %}
              >
                {{ block.settings.label }}
                {% if block.settings.open_in_new_window %}
                  <span class="external-link-icon" aria-hidden="true" style="margin-left: 0.25em; display: inline-flex; align-items: center;">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M7 17L17 7M17 7H7M17 7V17"/>
                    </svg>
                  </span>
                {% endif %}
              </a>
            {%- endif -%}
          {%- endif -%}
        {%- endfor -%}
      </nav>
      
      {% comment %} Mobile Logo - Only visible on mobile {% endcomment %}
      <div class="redesign-header__mobile-logo">
        <a href="{{ routes.root_url }}">
          {% if section.settings.logo %}
            <img src="{{ section.settings.logo | image_url: width: 200 }}" alt="{{ shop.name }}" width="200" height="50">
          {% else %}
            <img src="/cdn/shop/files/olitalia_logo_black.svg?v=1766151501&width=200" alt="Olitalia" width="200" height="50">
          {% endif %}
        </a>
      </div>
    </div>
    
    {% comment %} Right Side - Search & Cart {% endcomment %}
    <div class="redesign-header__right">
      <a href="{{ routes.search_url }}" class="redesign-header__icon" aria-label="Search">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
      </a>
      
      <a href="{{ routes.cart_url }}" class="redesign-header__icon redesign-header__cart" aria-label="Cart ({{ cart.item_count }} items)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="9" cy="21" r="1"/>
          <circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
        {% if cart.item_count > 0 %}
          <span class="redesign-header__cart-count" data-header-cart-count>{{ cart.item_count }}</span>
        {% endif %}
      </a>
    </div>
    
  </div>
</header>

{% comment %} Mobile Menu Overlay {% endcomment %}
<div class="redesign-mobile-menu" id="mobileMenu">
  <div class="redesign-mobile-menu__header">
    <div class="redesign-mobile-menu__icons">
      <a href="{{ routes.search_url }}" class="redesign-mobile-menu__icon" aria-label="Search">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
      </a>
      
      <a href="{{ routes.cart_url }}" class="redesign-mobile-menu__icon redesign-mobile-menu__cart" aria-label="Cart ({{ cart.item_count }} items)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="9" cy="21" r="1"/>
          <circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
        {% if cart.item_count > 0 %}
          <span class="redesign-mobile-menu__cart-count" data-header-cart-count>{{ cart.item_count }}</span>
        {% endif %}
      </a>
    </div>
    
    <div class="redesign-mobile-menu__logo">
      <a href="{{ routes.root_url }}">
        {% if section.settings.logo %}
          <img src="{{ section.settings.logo | image_url: width: 200 }}" alt="{{ shop.name }}" width="200" height="80">
        {% else %}
          <img src="/cdn/shop/files/olitalia_logo_black.svg?v=1766151501&width=200" alt="Olitalia" width="200" height="80">
        {% endif %}
      </a>
    </div>
    
    <button class="redesign-mobile-menu__close" onclick="toggleMenu()" aria-label="Close Menu">
      <span class="redesign-mobile-menu__close-line"></span>
      <span class="redesign-mobile-menu__close-line"></span>
    </button>
  </div>
  
  <nav class="redesign-mobile-menu__nav">
    <a href="{{ routes.root_url }}" class="redesign-mobile-menu__link">Home</a>
    <a href="/pages/about-us" class="redesign-mobile-menu__link">About Us</a>
    <a href="/pages/production" class="redesign-mobile-menu__link">Production</a>
    <a href="/pages/sustainability" class="redesign-mobile-menu__link">Sustainability</a>
    <a href="/pages/recipes" class="redesign-mobile-menu__link">Recipes</a>
    <a href="/products/extra-virgin-olive-oil" class="redesign-mobile-menu__link">Products</a>
    
    {% comment %} External Links from blocks {% endcomment %}
    {%- for block in section.blocks -%}
      {%- if block.type == 'external-link' -%}
        {%- if block.settings.url != blank and block.settings.label != blank -%}
          <a 
            href="{{ block.settings.url }}" 
            class="redesign-mobile-menu__link"
            {{ block.shopify_attributes }}
            {% if block.settings.open_in_new_window %}
              target="_blank" 
              rel="noopener noreferrer"
              aria-label="{{ block.settings.label }} (opens in new window)"
            {% endif %}
          >
            {{ block.settings.label }}
            {% if block.settings.open_in_new_window %}
              <span class="external-link-icon" aria-hidden="true" style="margin-left: 0.5em; display: inline-flex; align-items: center;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M7 17L17 7M17 7H7M17 7V17"/>
                </svg>
              </span>
            {% endif %}
          </a>
        {%- endif -%}
      {%- endif -%}
    {%- endfor -%}
  </nav>
</div>

<script>
function toggleMenu() {
  const menu = document.getElementById('mobileMenu');
  const body = document.body;
  
  if (menu.classList.contains('active')) {
    menu.classList.remove('active');
    body.style.overflow = '';
  } else {
    menu.classList.add('active');
    body.style.overflow = 'hidden';
  }
}

// Add active class to current page navigation link
document.addEventListener('DOMContentLoaded', function() {
  const currentPath = window.location.pathname;
  const navLinks = document.querySelectorAll('.redesign-header__nav-link, .redesign-mobile-menu__link');
  
  console.log('Current path:', currentPath); // Debug
  
  navLinks.forEach(link => {
    const linkPath = new URL(link.href).pathname;
    console.log('Checking link:', linkPath, 'against current:', currentPath); // Debug
    
    // Remove any existing active class first
    link.classList.remove('active');
    
    // Check if current page matches the link - improved matching logic
    let isActive = false;
    
    if (currentPath === linkPath) {
      isActive = true;
    } else if (currentPath === '/' && linkPath === '/') {
      isActive = true;
    } else if (currentPath.includes('/pages/about-us') && linkPath.includes('/pages/about-us')) {
      isActive = true;
    } else if (currentPath.includes('/pages/production') && linkPath.includes('/pages/production')) {
      isActive = true;
    } else if (currentPath.includes('/pages/sustainability') && linkPath.includes('/pages/sustainability')) {
      isActive = true;
    } else if (currentPath.includes('/pages/recipes') && linkPath.includes('/pages/recipes')) {
      isActive = true;
    } else if (currentPath.includes('/products/') && linkPath.includes('/products/')) {
      isActive = true;
    } else if (currentPath.includes('/blogs/') && linkPath.includes('/pages/recipes')) {
      isActive = true;
    }
    
    if (isActive) {
      link.classList.add('active');
      console.log('Added active class to:', link.textContent, 'for path:', linkPath); // Debug
    }
  });
  
  // Force a repaint to ensure CSS transitions work
  setTimeout(() => {
    document.body.style.display = 'none';
    document.body.offsetHeight; // Trigger reflow
    document.body.style.display = '';
  }, 10);
});
</script>

{% schema %}
{
  "name": "Redesign Header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    }
  ],
  "blocks": [
    {
      "type": "external-link",
      "name": "External Link",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Link Label",
          "default": "External Link"
        },
        {
          "type": "url",
          "id": "url",
          "label": "External URL",
          "info": "Enter the full URL including https://"
        },
        {
          "type": "checkbox",
          "id": "open_in_new_window",
          "label": "Open in new window",
          "default": true
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Redesign Header"
    }
  ]
}
{% endschema %}

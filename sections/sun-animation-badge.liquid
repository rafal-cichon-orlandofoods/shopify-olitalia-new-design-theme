<style>
.sun-animation-section {
  padding: 80px 20px;
  background: #fff;
  text-align: center;
}

.sun-animation-container {
  max-width: 1200px;
  margin: 0 auto;
}

.sun-animation-wrapper {
  display: inline-block;
  margin: 0 auto;
}

#sun_animation_container {
  background-color: rgba(255, 255, 255, 1.00);
  width: 150px;
  height: 150px;
  margin: 0 auto;
  position: relative;
}

#sun_canvas {
  width: 150px;
  height: 150px;
  position: absolute;
  display: block;
  background-color: rgba(255, 255, 255, 1.00);
}

#sun_dom_overlay_container {
  pointer-events: none;
  overflow: hidden;
  width: 150px;
  height: 150px;
  position: absolute;
  left: 0px;
  top: 0px;
  display: block;
}

/* Responsive */
@media (max-width: 768px) {
  .sun-animation-section {
    padding: 60px 20px;
  }
  
  #sun_animation_container,
  #sun_canvas,
  #sun_dom_overlay_container {
    width: 120px;
    height: 120px;
  }
}
</style>

<section class="sun-animation-section">
  <div class="sun-animation-container">
    <div class="sun-animation-wrapper">
      <div id="sun_animation_container">
        <canvas id="sun_canvas" width="150" height="150"></canvas>
        <div id="sun_dom_overlay_container"></div>
      </div>
    </div>
  </div>
</section>

<script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
<script src="{{ 'olitalia-sun-animation.js' | asset_url }}"></script>
<script>
var canvas, stage, exportRoot, anim_container, dom_overlay_container, fnStartAnimation;

function initSunAnimation() {
  canvas = document.getElementById("sun_canvas");
  anim_container = document.getElementById("sun_animation_container");
  dom_overlay_container = document.getElementById("sun_dom_overlay_container");
  
  var comp = AdobeAn.getComposition("117E02CA86B748899282774A40150680");
  var lib = comp.getLibrary();
  var loader = new createjs.LoadQueue(false);
  
  loader.addEventListener("fileload", function(evt){
    handleFileLoad(evt,comp);
  });
  
  loader.addEventListener("complete", function(evt){
    handleComplete(evt,comp);
  });
  
  var lib = comp.getLibrary();
  loader.loadManifest(lib.properties.manifest);
}

function handleFileLoad(evt, comp) {
  var images = comp.getImages();    
  if (evt && (evt.item.type == "image")) { 
    images[evt.item.id] = evt.result; 
  }    
}

function handleComplete(evt,comp) {
  var lib = comp.getLibrary();
  var ss = comp.getSpriteSheet();
  var queue = evt.target;
  var ssMetadata = lib.ssMetadata;
  
  for(i=0; i<ssMetadata.length; i++) {
    ss[ssMetadata[i].name] = new createjs.SpriteSheet({
      "images": [queue.getResult(ssMetadata[i].name)], 
      "frames": ssMetadata[i].frames
    });
  }
  
  exportRoot = new lib.olitaliasunanimation();
  stage = new lib.Stage(canvas);
  
  fnStartAnimation = function() {
    stage.addChild(exportRoot);
    createjs.Ticker.framerate = lib.properties.fps;
    createjs.Ticker.addEventListener("tick", stage);
  }
  
  AdobeAn.makeResponsive(false,'both',false,1,[canvas,anim_container,dom_overlay_container]);
  AdobeAn.compositionLoaded(lib.properties.id);
  fnStartAnimation();
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initSunAnimation);
} else {
  initSunAnimation();
}
</script>

{% schema %}
{
  "name": "Sun Animation Badge",
  "settings": [
    {
      "type": "header",
      "content": "Animation Settings"
    },
    {
      "type": "paragraph",
      "content": "Animated sun badge with olive branch and text"
    }
  ],
  "presets": [
    {
      "name": "Sun Animation Badge"
    }
  ]
}
{% endschema %}

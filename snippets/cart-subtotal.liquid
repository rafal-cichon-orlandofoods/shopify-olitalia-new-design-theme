{% comment %}
  Renders cart subtotal, checkout buttons, notes and shipping notice (page version).

	Accepts: 
	- type: {String} 'page' or 'sidebar'.

  Usage:
  {% render 'cart-subtotal', type: 'page' %}
{% endcomment %}

<div id="AjaxCartSubtotal">

  {%- liquid
    if settings.show_currency_codes
      assign iso_code = localization.country.currency.iso_code | prepend: ' ' 
    endif
  -%}

	{%- if type == 'page' -%}

		{%- if settings.cart_free_shipping -%}
			<div class="sidebar-widget sidebar-widget--outline gutter-regular margin-bottom--regular">
				<div class="sidebar-widget__content">
					<shipping-notice
						data-free-shipping="{{ settings.cart_free_shipping_amount | times: 100 }}"
						data-cart-total="{{ cart.total_price }}"
					>
						<span data-js-free-shipping-text></span>
						<span class="cart-notice__slider">
							<span class="cart-notice__slider-bar" data-js-free-shipping-slider></span>
						</span>
					</shipping-notice>
					<script src="{{ 'component-shipping-notice.js' | asset_url }}" defer></script>
				</div>
			</div>
		{%- endif -%}

		{%- liquid
			unless settings.cart_upsell_product == blank
				render 'product-cross-sell', heading: settings.cart_upsell_heading, product: settings.cart_upsell_product, id: 'cart-individual-product-cross-sell', widget_style: 'outline', heading_position: 'widget', class: 'cart-individual-product-recommendation hide-if-empty-cart margin-bottom--regular', layout: 'expanded'
			endunless
		-%}

	{%- endif -%}

	<div class="cart__details 
		{% if type == 'page' %} cart__subtotal-widget element--has-border--body element--border-radius {% endif %}
		{% if cart.item_count == 0 %} cart--empty {% endif %}
	">

		{%- if settings.cart_notes_enable and type == 'page' -%}
			<div class="cart__instructions">
				<div class="form-field">
					<cart-note>
						<label for="CartPage-Note">{{ 'cart.note' | t }}</label>
						<textarea id="CartPage-Note" name="note">{{ cart.note }}</textarea>
					</cart-note> 
				</div>
			</div>
		{%- endif -%}

		{%- if settings.show_discount_code -%}
			{%- liquid
				assign discount_codes = cart.cart_level_discount_applications | where: 'type', 'discount_code' | map: 'title'
				for item in cart.items
					for allocation in item.line_level_discount_allocations
						if allocation.discount_application.type == 'discount_code'
							assign discount_codes = item.line_level_discount_allocations | slice: forloop.index0 | map: 'discount_application' | map: 'title' | concat: discount_codes
						endif
					endfor
				endfor
				assign discount_codes = discount_codes | uniq
			-%}

			{%- if type == 'page' -%}
				<div class="cart__coupons">
					<div class="form-field">
						<cart-discounts>

							<label for="CartPage-Discount">
								{{ 'cart.discount_codes_label' | t }}
							</label>
						
							<form class="cart__coupons-form">
								<input id="CartPage-Discount" name="discount" type="text" data-js-discount-input>
								<button type="submit" id="cartDiscountSubmit" class="button button--solid" data-js-discount-submit>
									{{ 'collections.apply' | t }}
								</button>
							</form>

							{%- if settings.discount_text != blank -%}
								<div class="cart__coupons-label text-size--small text-color--opacity">
									{{ settings.discount_text | escape }}
								</div>
							{%- endif -%}
							
							<div class="cart__coupons-error" data-js-discount-error></div>

							<div class="cart__coupons-codes">
								{%- for discount_code in discount_codes -%}
									{%- render 'cart-item-discount', discount: discount_code, remove: true -%}
								{%- endfor -%}
							</div>

						</cart-discounts>
					</div>
				</div>
			{%- else -%}
				<div data-js-discount-codes style="display: none !important">
					{%- for discount_code in discount_codes -%}
						{%- render 'cart-item-discount', discount: discount_code, remove: true -%}
					{%- endfor -%}
				</div>
			{%- endif -%}
		{%- endif -%}
			    
		{%- if cart.cart_level_discount_applications != blank -%} 
			<div class="cart__subtotal cart__details--row">
				<span>{{ 'cart.subtotal' | t }}</span>
				<strong>{{ cart.items_subtotal_price | money | append: iso_code }}</strong>
			</div>
			<div class="cart__discounts cart__details--row" {% if cart.cart_level_discount_applications.size > 1 %} style="align-items: flex-start" {% endif %}>
				<span>{{ 'cart.discounts' | t }}</span>
				<div class="cart__discount-codes">
					{%- for discount_application in cart.cart_level_discount_applications -%}
						<span class="cart__discount-code">
							<span class="cart__discount-code-title">
								{%- render 'theme-symbols', icon: 'discount' -%}
								{{ discount_application.title }}
							</span>
							<span class="cart__discount-code-amount">-{{ discount_application.total_allocated_amount | money | append: iso_code }} </span>
						</span>
					{%- endfor -%}
				</div>
			</div>
		{%- endif -%}

		<div class="cart__total cart__details--row">
			<span>{{ 'cart.total' | t }}</span> 
			<strong>{{ cart.total_price | money | append: iso_code }}</strong>
		</div>

		

		<div class="cart__shipping text-color--opacity text-size--small">
			{%- liquid
				if cart.taxes_included and shop.shipping_policy.body != blank
					echo 'cart.policies.taxes_included_and_shipping_policy_html' | t: link: shop.shipping_policy.url
				elsif cart.taxes_included
					echo 'cart.policies.taxes_included_but_shipping_at_checkout' | t
				elsif shop.shipping_policy.body != blank
					echo 'cart.policies.taxes_and_shipping_policy_at_checkout_html' | t: link: shop.shipping_policy.url
				else
					echo 'cart.policies.taxes_and_shipping_at_checkout' | t
				endif
			-%}
		</div>

		{%- if settings.cart_terms_checkbox -%}
			<terms-checkbox>
				<div class="agree-to-terms gutter-top--small">
					<input type="checkbox" id="AgreeToTos" class="styled-checkbox" required />
					<label for="AgreeToTos" class="text-size--small">
						{{ settings.cart_terms_text }}
					</label>
				</div>
			</terms-checkbox>

			<script src="{{ 'component-terms-checkbox.js' | asset_url }}" defer></script>
		{%- endif -%}

		<div {% unless template contains 'cart' %} class="flex-buttons" {% endunless %}>
			{%- unless type == 'page' -%}
				{%- if settings.cart_drawer_actions contains 'show-view' -%}
					<a id="ViewCart" href="{{ routes.cart_url }}" class="button button--regular button--outline button--move">
						<span class="button__text">{{ 'cart.view_cart' | t }}</span>
					</a>
				{%- endif -%}
			{%- endunless -%}
			{%- if type == 'page' -%}
				<a href="{{ routes.all_products_collection_url }}" class="button button--regular button--outline button--move cart__continue-shopping">
					<span class="button__text">{{ 'cart.continue_browsing' | t }}</span>
				</a>
			{%- endif -%}
			{%- if settings.cart_drawer_actions contains 'show-checkout' or type == 'page' -%}
				<button id="CheckOut" class="button button--regular button--solid button--move" type="submit" name="checkout" form="cart" {%- if settings.cart_terms_checkbox -%} disabled {%- endif -%}>
					<span class="button__text">{{ 'cart.checkout' | t }}</span>
				</button>
			{%- endif -%}
		</div>

		{%- unless template contains 'order' -%}  
			{%- if settings.cart_drawer_actions contains 'show-checkout' or type == 'page' -%}
				{%- if additional_checkout_buttons and settings.cart_additional_buttons -%}
					<div class="additional-checkout-buttons additional-checkout-buttons--vertical">{{ content_for_additional_checkout_buttons }}</div>
				{%- endif -%}
			{%- endif -%}
		{%- endunless -%}

	</div>

</div>